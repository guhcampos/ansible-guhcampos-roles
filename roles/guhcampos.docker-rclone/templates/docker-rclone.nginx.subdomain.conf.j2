server {
  include /config/nginx/ssl.conf;

  server_name {{rclone_nginx_server_name}};

  listen 443 ssl http2;
  listen [::]:443 ssl http2;
  client_max_body_size 0;
  access_log /dev/stdout;
  error_log /dev/stdout info;

  location / {
      include /config/nginx/proxy.conf;
      include /config/nginx/resolver.conf;
      set $upstream_app rclone;
      set $upstream_port {{rclone_nginx_http_port}};
      set $upstream_proto http;
      proxy_set_header   X-Real-IP $remote_a  ddr;
      proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_pass $upstream_proto://$upstream_app:$upstream_port;

  }

location ^~ /rclone/websockify {
    include /config/nginx/proxy.conf;
    include /config/nginx/resolver.conf;
    set $upstream_app rclone;
    set $upstream_port {{rclone_nginx_http_port}};
    set $upstream_proto http;
    proxy_set_header   X-Real-IP $remote_addr;
      proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_pass $upstream_proto://$upstream_app:$upstream_port/websockify/;
  }

}
